# Phase 2: 비주얼 노블 고도화 기획서

**프로젝트:** Word Master: My Own Novel Dungeon  
**버전:** Phase 2  
**작성일:** 2025-11-20  
**상태:** 📋 기획 단계

---

## 🎯 Phase 2 목표

Phase 1에서 구축한 기본 게임 플로우를 바탕으로, **진정한 비주얼 노블 경험**을 제공하기 위해 이미지 생성 기능을 통합하고, 게임 메커니즘을 확장합니다.

### 핵심 목표
1. ✨ **이미지 생성 통합** - 각 챕터마다 AI 생성 일러스트 표시
2. 🎮 **게임 메커니즘 확장** - 인벤토리, 아이템, 레벨업 시스템
3. 🧠 **SM-2 학습 시스템** - Anki 방식의 간격 반복 학습 (Spaced Repetition)
4. 💾 **데이터 영속성** - 게임 진행 저장/로드
5. 🎨 **UX 개선** - 스토리 히스토리, 북마크, 공유 기능
6. ⚡ **성능 최적화** - 이미지 캐싱, 코드 스플리팅

---

## 📅 Phase 2 일정

### 전체 일정: 4주 (예상)

| 주차 | 주요 작업 | 산출물 |
|------|----------|--------|
| 1주차 | 이미지 생성 통합 + SM-2 알고리즘 | 이미지 생성 서비스, 캐싱 시스템, SM-2 핵심 로직 |
| 2주차 | 게임 메커니즘 확장 + 단어 카드 시스템 | 인벤토리, 아이템, 레벨업, WordCard 구조 |
| 3주차 | 데이터 영속성 + 복습 시스템 | 저장/로드, 히스토리 뷰어, 복습 화면 |
| 4주차 | UX 개선 및 최적화 + 학습 분석 | 공유 기능, 성능 개선, 학습 통계 대시보드 |

---

## 🎨 1. 이미지 생성 통합

### 1.1 목표
각 챕터의 `image_prompt`를 활용하여 실제 일러스트를 생성하고 스토리 화면에 표시

### 1.2 기술 선택지

#### Option A: DALL-E 3 (OpenAI)
**장점**:
- 고품질 이미지
- 빠른 생성 속도 (10-20초)
- 프롬프트 이해도 우수

**단점**:
- 비용 발생 ($0.04/이미지)
- API 키 필요

**추천 사용 케이스**: 프로덕션 환경

#### Option B: Stable Diffusion (로컬)
**장점**:
- 무료
- 프라이버시 보호
- 커스터마이징 가능

**단점**:
- 느린 생성 속도 (30-60초)
- GPU 필요
- 품질이 DALL-E보다 낮을 수 있음

**추천 사용 케이스**: 개발/테스트 환경

#### Option C: Stable Diffusion API (Replicate/HuggingFace)
**장점**:
- 중간 비용
- 로컬 GPU 불필요
- 다양한 모델 선택

**단점**:
- API 키 필요
- 생성 속도 중간

**추천 사용 케이스**: 하이브리드 환경

### 1.3 구현 계획

#### 1.3.1 이미지 생성 서비스
**파일**: `src/lib/imageGenerator.js`

**기능**:
- `generateImage(prompt)`: 프롬프트로 이미지 생성
- `getCachedImage(prompt)`: 캐시된 이미지 확인
- `saveImageToCache(prompt, imageUrl)`: 이미지 캐싱

**API 통합**:
```javascript
// DALL-E 예시
async function generateImage(prompt) {
  const response = await openai.images.generate({
    model: "dall-e-3",
    prompt: prompt,
    size: "1024x1024",
    quality: "standard",
    style: "vivid"
  });
  return response.data[0].url;
}
```

#### 1.3.2 이미지 캐싱 시스템
**목적**: 동일한 프롬프트로 중복 생성 방지

**저장 위치**:
- **로컬 스토리지**: 프롬프트 → 이미지 URL 매핑
- **IndexedDB**: 실제 이미지 데이터 (선택사항)

**캐시 전략**:
```javascript
{
  "prompt_hash": {
    "url": "blob:...",
    "timestamp": 1234567890,
    "expiresIn": 7 * 24 * 60 * 60 * 1000 // 7일
  }
}
```

#### 1.3.3 StoryScreen 업데이트
**추가 기능**:
- 이미지 로딩 상태 표시
- 이미지 표시 (스토리 위/옆)
- 이미지 확대 모달
- 이미지 다운로드 버튼

**레이아웃**:
```
┌─────────────────────────────┐
│   Chapter Title             │
├─────────────────────────────┤
│                             │
│   [Generated Image]         │
│   (1024x1024)               │
│                             │
├─────────────────────────────┤
│   Story Content             │
│   (highlighted words)       │
└─────────────────────────────┘
```

### 1.4 성능 고려사항

#### 1.4.1 이미지 생성 타이밍
**Option A: 스토리 생성과 동시**
- 장점: 사용자 대기 시간 단축
- 단점: 복잡한 에러 처리

**Option B: 스토리 표시 후 생성**
- 장점: 단순한 구조
- 단점: 추가 대기 시간

**추천**: Option B (단순성 우선)

#### 1.4.2 이미지 최적화
- WebP 포맷 사용
- Lazy loading
- Progressive loading (blur → sharp)
- 썸네일 생성 (선택사항)

### 1.5 비용 추정 (DALL-E 3 기준)

| 항목 | 비용 |
|------|------|
| 이미지 생성 | $0.04/이미지 |
| 평균 플레이 (10 챕터) | $0.40 |
| 100명 사용자 | $40 |
| 1,000명 사용자 | $400 |

**비용 절감 전략**:
- 캐싱 시스템 (중복 생성 방지)
- 무료 할당량 활용
- Stable Diffusion 하이브리드 사용

---

## 🎮 2. 게임 메커니즘 확장

### 2.1 인벤토리 시스템

#### 2.1.1 아이템 타입
```javascript
const ITEM_TYPES = {
  POTION: {
    id: 'hp_potion',
    name: 'HP 포션',
    description: 'HP를 1 회복합니다',
    effect: { hp: +1 },
    icon: '🧪'
  },
  SHIELD: {
    id: 'shield',
    name: '방패',
    description: '다음 오답 시 HP 감소 방지',
    effect: { protection: 1 },
    icon: '🛡️'
  },
  HINT: {
    id: 'hint',
    name: '힌트',
    description: '퀴즈에서 오답 1개 제거',
    effect: { removeWrongAnswer: 1 },
    icon: '💡'
  },
  DICTIONARY: {
    id: 'dictionary',
    name: '사전',
    description: '단어 뜻을 확인할 수 있습니다',
    effect: { showDefinition: true },
    icon: '📖'
  }
};
```

#### 2.1.2 아이템 획득 방법
1. **퀴즈 정답 보상**: 랜덤 아이템 드롭
2. **연속 정답 보너스**: 3연속 정답 시 특별 아이템
3. **챕터 클리어 보상**: 5챕터마다 보상
4. **숨겨진 이벤트**: 특정 행동 선택 시

#### 2.1.3 인벤토리 UI
**위치**: 화면 상단 또는 우측 사이드바

**표시 정보**:
- 아이템 아이콘
- 수량
- 사용 버튼

### 2.2 레벨업 시스템

#### 2.2.1 경험치 시스템
```javascript
const XP_SYSTEM = {
  퀴즈_정답: 10,
  챕터_완료: 50,
  연속_정답: 20,
  완벽한_챕터: 100 // HP 손실 없이 클리어
};
```

#### 2.2.2 레벨 혜택
| 레벨 | 필요 XP | 혜택 |
|------|---------|------|
| 1 | 0 | 기본 HP 3 |
| 2 | 100 | HP +1 (최대 4) |
| 3 | 250 | 시작 아이템 1개 |
| 4 | 500 | 힌트 자동 획득 |
| 5 | 1000 | 최대 HP +1 (최대 5) |

#### 2.2.3 스킬 시스템 (선택사항)
- **단어 마스터**: 퀴즈 시간 제한 증가
- **스토리텔러**: 더 긴 스토리 생성
- **탐험가**: 숨겨진 이벤트 발견 확률 증가

### 2.3 난이도 시스템

#### 2.3.1 난이도 레벨
```javascript
const DIFFICULTY = {
  EASY: {
    label: '쉬움',
    hp: 5,
    quizTime: 60,
    itemDropRate: 0.5
  },
  NORMAL: {
    label: '보통',
    hp: 3,
    quizTime: 30,
    itemDropRate: 0.3
  },
  HARD: {
    label: '어려움',
    hp: 2,
    quizTime: 20,
    itemDropRate: 0.2
  }
};
```

#### 2.3.2 동적 난이도 조정
- 연속 실패 시 난이도 자동 하락
- 연속 성공 시 보너스 보상

### 2.4 상태 관리 확장

#### 2.4.1 GameContext 업데이트
```javascript
const initialState = {
  // 기존 상태
  gameState: 'INPUT',
  userData: { ... },
  rpgState: {
    turn: 1,
    hp: 3,
    maxHp: 3,
    history: [],
    isGameOver: false,
    // 새로운 필드
    level: 1,
    xp: 0,
    inventory: [],
    difficulty: 'NORMAL',
    stats: {
      totalQuizzes: 0,
      correctAnswers: 0,
      chaptersCompleted: 0,
      itemsUsed: 0
    }
  },
  currentStory: null,
  error: null
};
```

---

## 💾 3. 데이터 영속성

### 3.1 저장/로드 시스템

#### 3.1.1 저장 데이터 구조
```javascript
const SAVE_DATA = {
  version: '2.0',
  timestamp: 1234567890,
  gameState: { ... },
  userData: { ... },
  rpgState: { ... },
  storyHistory: [
    {
      turn: 1,
      title: '...',
      content: '...',
      imageUrl: '...',
      userAction: '...'
    }
  ]
};
```

#### 3.1.2 저장 위치
**로컬 스토리지**:
- 키: `word-master-save-${slot}`
- 최대 3개 슬롯 지원

**클라우드 저장 (선택사항)**:
- Firebase/Supabase 연동
- 계정 시스템 필요

#### 3.1.3 자동 저장
- 챕터 완료 시 자동 저장
- 5분마다 자동 저장 (선택사항)
- 브라우저 종료 전 저장

### 3.2 스토리 히스토리 뷰어

#### 3.2.1 기능
- 이전 챕터 다시 보기
- 이미지 갤러리
- 선택한 행동 히스토리
- 타임라인 뷰

#### 3.2.2 UI 구성
```
┌─────────────────────────────┐
│   Story History             │
├─────────────────────────────┤
│ ┌─────┐ Chapter 1           │
│ │ IMG │ 철수와 추상화의 검    │
│ └─────┘ "탐험을 계속한다"    │
├─────────────────────────────┤
│ ┌─────┐ Chapter 2           │
│ │ IMG │ 블랙홀의 비밀        │
│ └─────┘ "블랙홀로 돌진한다"  │
└─────────────────────────────┘
```

### 3.3 북마크 시스템

#### 3.3.1 기능
- 중요한 챕터 북마크
- 북마크 메모 추가
- 빠른 이동

#### 3.3.2 데이터 구조
```javascript
const BOOKMARK = {
  id: 'bookmark_1',
  turn: 5,
  title: '결정적 순간',
  note: '여기서 중요한 선택을 했음',
  timestamp: 1234567890
};
```

---

## 🎨 4. UX 개선

### 4.1 스토리 공유 기능

#### 4.1.1 공유 옵션
1. **이미지로 공유**
   - 스토리 + 이미지를 하나의 이미지로 합성
   - SNS 공유 최적화

2. **링크로 공유**
   - 읽기 전용 링크 생성
   - 타인이 내 스토리 읽기 가능

3. **텍스트로 공유**
   - 스토리 텍스트 복사
   - 마크다운 형식 지원

#### 4.1.2 프라이버시 설정
- 공개/비공개 선택
- 특정 챕터만 공유
- 공유 링크 만료 시간

### 4.2 사운드 이펙트

#### 4.2.1 사운드 종류
- 버튼 클릭 소리
- 퀴즈 정답/오답 소리
- 레벨업 소리
- 아이템 획득 소리
- 배경음악 (선택사항)

#### 4.2.2 사운드 라이브러리
- **추천**: Howler.js
- 볼륨 조절 기능
- 음소거 토글

### 4.3 튜토리얼 시스템

#### 4.3.1 단계별 가이드
1. **첫 플레이**: 기본 조작 설명
2. **첫 퀴즈**: 퀴즈 시스템 설명
3. **첫 아이템**: 인벤토리 사용법
4. **첫 레벨업**: 레벨 시스템 설명

#### 4.3.2 UI
- 툴팁 형식
- 스킵 가능
- 다시 보기 옵션

### 4.4 접근성 개선

#### 4.4.1 기능
- 키보드 네비게이션
- 스크린 리더 지원
- 고대비 모드
- 폰트 크기 조절

#### 4.4.2 다국어 지원 (선택사항)
- 영어 번역
- UI 텍스트 분리
- i18n 라이브러리 사용

---

## ⚡ 5. 성능 최적화

### 5.1 코드 스플리팅

#### 5.1.1 라우트 기반 분리
```javascript
const StoryScreen = lazy(() => import('./components/StoryScreen'));
const QuizScreen = lazy(() => import('./components/QuizScreen'));
```

#### 5.1.2 컴포넌트 최적화
- React.memo 사용
- useMemo/useCallback 활용
- 불필요한 리렌더링 방지

### 5.2 이미지 최적화

#### 5.2.1 전략
- Lazy loading
- Progressive loading
- WebP 포맷
- 반응형 이미지 (srcset)

#### 5.2.2 캐싱
- Service Worker 사용
- IndexedDB 저장
- 오프라인 지원

### 5.3 번들 크기 최적화

#### 5.3.1 목표
- 초기 번들: < 200KB (gzip)
- 총 번들: < 500KB (gzip)

#### 5.3.2 전략
- Tree shaking
- 불필요한 라이브러리 제거
- 동적 import

### 5.4 LLM 응답 최적화

#### 5.4.1 스트리밍 응답
- OpenAI streaming API 사용
- 실시간 텍스트 표시
- 사용자 경험 개선

#### 5.4.2 프롬프트 최적화
- 토큰 수 줄이기
- 캐시 활용
- 배치 요청 (선택사항)

---

## 📊 6. 데이터 분석 및 통계

### 6.1 플레이 통계

#### 6.1.1 수집 데이터
- 총 플레이 시간
- 완료한 챕터 수
- 퀴즈 정답률
- 가장 많이 사용한 단어
- 선호하는 장르

#### 6.1.2 통계 대시보드
```
┌─────────────────────────────┐
│   Your Statistics           │
├─────────────────────────────┤
│ Total Chapters: 42          │
│ Quiz Accuracy: 85%          │
│ Favorite Genre: Fantasy     │
│ Play Time: 3h 24m           │
└─────────────────────────────┘
```

### 6.2 학습 진도 추적

#### 6.2.1 단어 마스터리
- 각 단어별 사용 횟수
- 정답률
- 마스터 레벨

#### 6.2.2 복습 시스템
- 틀린 단어 복습
- 간격 반복 학습 (Spaced Repetition)
- 복습 알림

---

## 🧪 7. 테스트 전략

### 7.1 유닛 테스트 추가

#### 7.1.1 새로운 테스트
- `imageGenerator.test.js`: 이미지 생성 로직
- `inventory.test.js`: 인벤토리 시스템
- `saveLoad.test.js`: 저장/로드 기능
- `levelSystem.test.js`: 레벨업 로직

#### 7.1.2 목표 커버리지
- 핵심 로직: 100%
- UI 컴포넌트: 80%
- 전체: 85%

### 7.2 E2E 테스트 확장

#### 7.2.1 새로운 시나리오
- 이미지 생성 플로우
- 아이템 사용
- 게임 저장/로드
- 스토리 공유

#### 7.2.2 성능 테스트
- 이미지 로딩 시간
- 페이지 전환 속도
- 메모리 사용량

### 7.3 사용자 테스트

#### 7.3.1 베타 테스트
- 5-10명 초등학생 대상
- 피드백 수집
- 버그 리포트

#### 7.3.2 A/B 테스트
- 이미지 스타일 선호도
- UI 레이아웃 비교
- 난이도 밸런스

---

## 📋 8. 구현 우선순위

### 8.1 Must Have (필수)
1. ✅ 이미지 생성 통합 (DALL-E 또는 Stable Diffusion)
2. ✅ 이미지 캐싱 시스템
3. ✅ SM-2 알고리즘 구현 (간격 반복 학습)
4. ✅ 단어 카드 시스템
5. ✅ 저장/로드 기능
6. ✅ 인벤토리 시스템 (기본)

### 8.2 Should Have (권장)
1. ⭐ 복습 모드 화면
2. ⭐ 레벨업 시스템
3. ⭐ 스토리 히스토리 뷰어
4. ⭐ 난이도 선택
5. ⭐ 사운드 이펙트

### 8.3 Could Have (선택)
1. 💡 학습 통계 대시보드
2. 💡 복습 스트릭 시스템
3. 💡 단어 마스터 뱃지
4. 💡 스토리 공유 기능
5. 💡 튜토리얼

### 8.4 Won't Have (제외)
1. ❌ 멀티플레이어
2. ❌ 실시간 채팅
3. ❌ 유료 결제 시스템
4. ❌ 모바일 앱 (웹 우선)

---

## 💰 9. 비용 및 리소스

### 9.1 예상 비용 (월간)

| 항목 | 비용 | 비고 |
|------|------|------|
| OpenAI API (LLM) | $50-100 | 사용량 기반 |
| DALL-E 3 (이미지) | $40-80 | 캐싱으로 절감 |
| 호스팅 (Vercel) | $0-20 | 무료 티어 가능 |
| 도메인 | $10-15 | 연간 |
| **총계** | **$100-215** | |

### 9.2 개발 리소스

| 역할 | 시간 | 비고 |
|------|------|------|
| 프론트엔드 개발 | 80시간 | 4주 |
| 테스트 작성 | 20시간 | 1주 |
| 문서화 | 10시간 | 병행 |
| 디자인 | 10시간 | 병행 |
| **총계** | **120시간** | |

---

## 🎯 10. 성공 지표 (KPI)

### 10.1 기술적 지표
- [ ] 이미지 생성 성공률 > 95%
- [ ] 페이지 로딩 시간 < 2초
- [ ] 이미지 로딩 시간 < 5초
- [ ] 테스트 커버리지 > 85%
- [ ] 번들 크기 < 500KB (gzip)

### 10.2 사용자 경험 지표
- [ ] 평균 플레이 시간 > 15분
- [ ] 챕터 완료율 > 70%
- [ ] 재방문율 > 40%
- [ ] 사용자 만족도 > 4.0/5.0

### 10.3 교육적 지표
- [ ] 단어 학습 정확도 > 80%
- [ ] 복습 참여율 > 50%
- [ ] 단어 마스터리 달성률 > 60%

---

## 🚀 11. 출시 계획

### 11.1 알파 버전 (1주차)
- 이미지 생성 기본 통합
- 내부 테스트

### 11.2 베타 버전 (2-3주차)
- 모든 핵심 기능 구현
- 베타 테스터 초대 (5-10명)
- 피드백 수집

### 11.3 정식 버전 (4주차)
- 버그 수정 완료
- 성능 최적화 완료
- 공개 출시

### 11.4 출시 후 계획
- 사용자 피드백 모니터링
- 버그 핫픽스
- Phase 3 기획 시작

---

## 📝 12. 리스크 관리

### 12.1 기술적 리스크

| 리스크 | 확률 | 영향 | 대응 방안 |
|--------|------|------|----------|
| 이미지 생성 실패 | 중 | 높음 | 폴백 이미지 준비 |
| API 비용 초과 | 중 | 중 | 캐싱 강화, 사용량 모니터링 |
| 성능 저하 | 낮 | 중 | 최적화, 코드 스플리팅 |
| 브라우저 호환성 | 낮 | 낮 | 폴리필, 테스트 |

### 12.2 비즈니스 리스크

| 리스크 | 확률 | 영향 | 대응 방안 |
|--------|------|------|----------|
| 사용자 부족 | 중 | 중 | 마케팅, SNS 홍보 |
| 경쟁 서비스 | 낮 | 중 | 차별화 포인트 강화 |
| 예산 부족 | 낮 | 높음 | 무료 대안 활용 |

---

## 🎓 13. 학습 목표

Phase 2를 통해 다음 기술을 학습하고 적용합니다:

1. **이미지 생성 AI**: DALL-E, Stable Diffusion
2. **캐싱 전략**: IndexedDB, Service Worker
3. **상태 관리 고급**: 복잡한 게임 상태
4. **성능 최적화**: 코드 스플리팅, Lazy loading
5. **데이터 영속성**: LocalStorage, 클라우드 저장

---

## 📚 14. 참고 자료

### 14.1 기술 문서
- [OpenAI DALL-E API](https://platform.openai.com/docs/guides/images)
- [Stable Diffusion](https://github.com/Stability-AI/stablediffusion)
- [IndexedDB Guide](https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API)
- [React Performance](https://react.dev/learn/render-and-commit)

### 14.2 디자인 참고
- 비주얼 노블 게임 UI/UX
- 교육용 게임 디자인 패턴
- 애니메이션 베스트 프랙티스

---

## ✅ 15. 체크리스트

### 15.1 기획 단계
- [x] Phase 2 목표 정의
- [x] 기능 우선순위 결정
- [x] 기술 스택 선정
- [x] 일정 수립
- [x] 리스크 분석
- [ ] 팀 리뷰 및 승인

### 15.2 개발 준비
- [ ] 개발 환경 설정
- [ ] API 키 발급
- [ ] 디자인 시스템 업데이트
- [ ] 테스트 계획 수립

### 15.3 구현 단계 (추후)
- [ ] 이미지 생성 서비스 구현
- [ ] 인벤토리 시스템 구현
- [ ] 저장/로드 기능 구현
- [ ] 테스트 작성 및 실행
- [ ] 문서 업데이트

---

**Phase 2 기획 완료일**: 2025-11-20  
**다음 단계**: 팀 리뷰 및 개발 착수  
**예상 완료일**: 2025-12-18 (4주 후)

---

## 💬 피드백 및 질문

Phase 2 기획서에 대한 피드백이나 질문이 있으시면 언제든지 말씀해 주세요!

**주요 결정 사항**:
1. 이미지 생성 API 선택 (DALL-E vs Stable Diffusion)
2. 인벤토리 시스템 범위
3. 클라우드 저장 여부
4. 출시 일정 조정

**검토 필요 항목**:
- 예산 승인
- 기술 스택 최종 확정
- 우선순위 재조정
